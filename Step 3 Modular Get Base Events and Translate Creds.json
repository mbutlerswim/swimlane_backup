{
    "modifiedByUser": {
        "$type": "Core.Models.Utilities.UserGroupSelection, Core", 
        "id": "58c07aedb104880f5094ac59", 
        "name": "admin"
    }, 
    "name": "Step 3 Modular Get Base Events and Translate Creds", 
    "triggers": [], 
    "$type": "Core.Models.Integrations.Task, Core", 
    "createdDate": "2017-01-18T19:20:28.185Z", 
    "disabled": false, 
    "createdByUser": {
        "$type": "Core.Models.Utilities.UserGroupSelection, Core", 
        "id": "58c07aedb104880f5094ac59", 
        "name": "admin"
    }, 
    "modifiedDate": "2017-09-12T18:04:25.473Z", 
    "outputs": [
        {
            "$type": "Core.Models.Integrations.Outputs.SetFieldValueOutput, Core", 
            "type": "setFieldValue", 
            "mappings": [
                {
                    "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
                    "type": "outputParameter", 
                    "value": "ao3q9", 
                    "key": "Output", 
                    "addMissing": false
                }
            ]
        }
    ], 
    "action": {
        "$type": "Core.Models.Integrations.Actions.Python.PythonAction, Core", 
        "readonly": false, 
        "type": "python", 
        "descriptor": {
            "availableOutputTypes": [
                "insertUpdateRecord", 
                "email", 
                "referentialTask", 
                "saveToFile", 
                "setFieldValue"
            ], 
            "description": "Execute Python scripts", 
            "family": "Scripts", 
            "$type": "Core.Models.Integrations.Actions.AvailableActionDescriptor, Core", 
            "name": "Python", 
            "disabled": false, 
            "readonly": false, 
            "actionType": "python", 
            "inputParameters": {
                "$type": "System.Collections.Generic.Dictionary`2[[System.String, mscorlib],[Core.Models.Integrations.Descriptors.Descriptor, Core]], mscorlib"
            }, 
            "id": "a1QptuwhoULMLWbC5", 
            "base64Image": "data:image/png;base64,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"
        }, 
        "script": "##############################################################################################################\n# Application Name: Alarms\n# Integration Name: Step 3 Modular Get Base Events and Translate Creds\n# Swimlane Version: 2.14 Patch 3\n# Global Integration: On\n#\n##############################################################################################################\n#\n# Validation Date                Validator                Pass/Fail             Comments\n# ###############                ###################      ##################    ##############################\n# 04/13/17  11:40 CDT\t\t\t Joel Laufer\t\t\t  Pass\n#\n#\n##############################################################################################################\n# Modificaitons\n##############################################################################################################\n#\n# Date Time Modified            Reason Modified             Developer\n# ######################        #####################       ############\n# 03/17/17 11:40 central        Added Comments Section      Joel Laufer\n#\n# 04/03/17 16:49 CDT\t\t\tAdded SQL Server Logging    Joel Laufer\n#                               and full_message and\n#                               alarm_id\n#\n# 04/12/17 20:20 CDT            Added Global Integration    Joel Laufer\n#\n# 04/22/17                     Streamlined code to pull     Mark V.\n#                              group of records into memory\n#                              and process.\n##############################################################################################################\n'''\n##############################################################################################################\n#   Inputs\n##############################################################################################################\n\nVariable                     Type                          Field                    Value\n################             ###############               ###############          ###############################\nCustomer_ID                  Record                        CustomerID\nSIEM_Platform\t\t\t\t Record\t\t\t\t\t\t   SIEM_Platform\nEVENT_ID\t\t\t\t\t Record\t\t\t\t\t\t   EventID\nTSOC2_User\t\t\t\t\t Credential Lib\t\t\t\t   tsoC2_User_A\nTSOC2_Credential\t\t\t Credential Lib\t\t\t\t   tsoC2_Credential_A\nTSOC1_User\t\t\t\t     Credential Lib\t\t\t\t   tsoC1_User_X\nTSOC1_Credential\t\t\t Credential Lib\t\t\t\t   tsoC1_Credential_X\nBoxster_User\t\t\t\t Credential Lib\t\t\t\t   boxster_user_x\nBoxster_Credential\t\t     Credential Lib\t\t\t\t   boxster_credential_x\nM5_User\t\t\t\t         Credential Lib\t\t\t\t   m5_user_x\nM5_Credential\t\t\t     Credential Lib\t\t\t\t   m5_credential_x\nNOSC_User\t\t\t\t     Credential Lib\t\t\t\t   nosc_user_x\nNOSC_Credential\t\t         Credential Lib\t\t\t\t   nosx_user_credential_x\nsiem_rule_name\t   \t\t\t Record\t\t\t\t\t\t   SIEM_Rule_Name\ntimeprofile_switch\t\t\t Static\t\t\t\t\t\t\t\t\t\t\t\t\tOff\npython_dynamic_code\t\t\t Static\t\t\t\t\t\t\t\t\t\t\t\t\tOn\nfull_message                 Record                        Full Message\nalarm_id\t\t\t\t\t Record                        Tracking Id\n\n##############################################################################################################\n#   Outputs\n##############################################################################################################\n\nParameter                    Type                          Field                        Value\n################             ###############               ###################          ###############################\nCustomer_Name\t             Output Parameter              Customer Name\npython_output                Output\t\t\t               Python Output\n\n\n\n'''\n\n##############################################################################################################\n# Python Coding Starts Here\n##############################################################################################################\n\n'''\n\nfrom CUST_PROFILES import customer\nfrom pprint import pprint\nfrom swimlane.core.auth import Client\nfrom swimlane.core.resources import App, Record, Report, User\nfrom swimlane.core.search import Search, filtering\nfrom pymongo import MongoClient\nimport base64\nimport requests\nimport ast\nimport datetime\nimport re\nimport json\nimport time\nimport datetime\n#from datetime import datetime, timedelta\n# Following imports Added by Joel on 01/18/17\nimport os\n'''\nfrom datetime import datetime, timedelta\nimport sys\nimport os\nsys.path.append(os.path.abspath(\"e:/SwimlaneConfigs/\"))\nfrom Global_Int_Var import *\n#connect_to_swimlane(sw_context.inputs['apiuser_user'],sw_context.inputs['apiuser_credential'])\nconnect_to_swimlane(\"SwimLaneAPIUser\", \"@r4J*@QeNCeys\")\n\ndef find_app_id(applicationname):\n     app=App.find(name=applicationname)\n     return(app.id)\n\n  \nBase_events_app_ID = find_app_id('Base Events') #\"584105309aee7c01ecd74dfd\"\nAlarms_app_ID = find_app_id('Alarms') #\"583f29e49aee7c0c2044c5bb\"\n\nglobal base_events_counter\nbase_events_counter=0\n\nalarm_id = sw_context.inputs['alarm_id']\nfull_message = sw_context.inputs['full_message']\naction_name = sw_context.inputs['action_name']\n\nprg_name = 'Step 3 Modular Get Base Events and Translate Creds'\n\n# timeprofile_switch=sw_context.inputs['timeprofile_switch']\n# python_dynamic_code=sw_context.inputs['python_dynamic_code']\n\n\n\n\n\ntimeprofile_switch = Timing_Profile_Mode\npython_dynamic_code = Dynamic_Python_Code_Mode\n\nfs = open(Debugging_File_Path + \"step_3_log.txt\", \"w+\")\nfs.write('Timing Profile: ' + timeprofile_switch + '\\n')\n\n\n\nif sw_context.inputs['base_event_gen']=='False':\n    \n    Create_Error_Log_Entry('Step 3 Modular Get Base Events and Translate Creds', \\\n                           '115', \\\n                           'Initiation', \\\n                           'N', \\\n                           'Base Event Generation Turned Off', \\\n                           '00:00:00', \\\n                           sw_context.inputs['alarm_id'], \\\n                           sw_context.inputs['full_message'], \\\n                           sw_context.inputs['action_name'], \\\n                           fs, \\\n                           sw_context.inputs['customer_name'], \\\n                           '', \\\n                           sw_context.inputs['siem_rule_name'], \\\n                           '0')\n    exit()\n\nif timeprofile_switch == 'On':\n    f = open(Debugging_File_Path + \"profile_3_get_base_events.txt\", \"a+\")\n    START_TIME = datetime.datetime.now()\n    f.write(\"\\r\\n[{}] START\".format(START_TIME))\n\nfs = open(Debugging_File_Path + \"step_3_log.txt\", \"w+\")\nfs.write('Timing Profile: ' + timeprofile_switch + '\\n')\n\n# START_TIME = datetime.datetime.now()\ns = datetime.datetime.now()\n\n\n# fs.write(START_TIME + sw_context.inputs['action_name'] + ' line 104 ' + str(customer_name) + '\\n')\n\n# host = '10.10.6.85'\n\ndef pychar_output():\n  if sw_context.inputs['charm_flag']=='On':    \n    fs_charm=open('e:\\SwimlaneConfigs\\step3a_charm.txt','w')\n    fs_charm.write(\"sw_context_inputs={'Customer_ID':'\" + sw_context.inputs['Customer_ID'] + \"',\" +'\\n' + \\\n                   \"'SIEM_Platform':'\" + sw_context.inputs['SIEM_Platform'] + \"',\" + '\\n' + \\\n                   \"'EVENT_ID':'\" + sw_context.inputs['EVENT_ID'] +  \"',\" + '\\n' + \\\n                   \"'TSOC2_User':'\" + sw_context.inputs['TSOC2_User']  +  \"',\" + '\\n' + \\\n                   \"'TSOC2_Credential':'\" + sw_context.inputs['TSOC2_Credential']  +  \"',\" + '\\n' + \\\n                   \"'TSOC1_User':'\" + sw_context.inputs['TSOC1_User']  +  \"',\" + '\\n' + \\\n                   \"'TSOC1_Credential':'\" + sw_context.inputs['TSOC1_Credential']  +  \"',\" + '\\n' + \\\n                   \"'Boxster_User':'\" + sw_context.inputs['Boxster_User']  +  \"',\" + '\\n' + \\\n                   \"'Boxster_Credential':'\" + sw_context.inputs['Boxster_Credential']  +  \"',\" + '\\n' + \\\n                   \"'M5_User':'\" + sw_context.inputs['M5_User']  +  \"',\" + '\\n' + \\\n                   \"'M5_Credential':'\" + sw_context.inputs['M5_Credential']  +  \"',\" + '\\n' + \\\n                   \"'NOSC_User':'\" + sw_context.inputs['NOSC_User']  +  \"',\" + '\\n' + \\\n                   \"'NOSC_Credential':'\" + sw_context.inputs['NOSC_Credential']  +  \"',\" + '\\n' + \\\n                   \"'siem_rule_name':'\" + sw_context.inputs['siem_rule_name']  +  \"',\" + '\\n' + \\\n                   \"'action_name':'\" + sw_context.inputs['action_name']  +  \"',\" + '\\n' + \\\n                   \"'full_message':'\" + sw_context.inputs['full_message']  +  \"',\" + '\\n' + \\\n                   \"'alarm_id':'\" + sw_context.inputs['alarm_id']  +  \"',\" + '\\n' + \\\n                   \"'customer_name':'\" + sw_context.inputs['customer_name']  +  \"',\" + '\\n' + \\\n                   \"'base_event_gen':'\" + sw_context.inputs['base_event_gen']  +  \"',\" + '\\n' + \\\n                   \"'apiuser_user':'\" + sw_context.inputs['apiuser_user']  +  \"',\" + '\\n' + \\\n                   \"'charm_flag':'\" + sw_context.inputs['charm_flag']  +  \"',\" + '\\n' + \\\n                   \"'apiuser_credential':'\" + sw_context.inputs['apiuser_credential'] +  \"'}\" + '\\n' )\n    fs_charm.write(\"sw_context_config['RecordId']':'\" + sw_context.config[\"RecordId\"]  +  \"']\" + '\\n')\n               \n\n    fs_charm.close()\n  else:\n    pass\n\npychar_output()\n\n\n\n\ndef format_dt(date_stg):\n    # fs=open(\"c:/test/base_event_debugging.txt\",\"w+\")\n    if (date_stg != \"\") or (date_stg != None):\n        Year1 = str(date_stg[0:4])\n        Month1 = str(date_stg[5:7])\n        Day1 = str(date_stg[8:10])\n        Time1 = str(date_stg[11:20])\n        frmt_date_stg = Month1 + \"/\" + Day1 + \"/\" + Year1 + \" \" + Time1\n    else:\n        frmt_date_stg = str(date_stg)\n    # fs.write(\"Orig Date Time: \" + date_stg + \"  Formatted Dt:\" + frmt_date_stg + \"\\n\")\n    # fs.close\n    return (frmt_date_stg)\n\n\n\ndef search_for_term(Search_Term, Field_Name_To_Search, App_Name_To_Search, *columns):\n    app = App.find(name=App_Name_To_Search)\n    current_user = next(User.find(name=Client.default.username), None)\n    search_field_id = app.field_id(Field_Name_To_Search)\n    columns_list = []\n    for col in columns:\n        columns_list.append(app.field_id(col))\n    report = Report.new_for(app.id, current_user.id, \"AdHocSearch\")\n    report.columns = [search_field_id] + columns_list  # ,ip_id,username_id,password_id]\n    report.filters = [filtering.create_filter(search_field_id, filtering.CONTAINS, Search_Term)]\n    search = Search(report)\n    result = search.execute()\n    records = result.records\n    return list(records)\n\n\ndef add_records_as_reference(Parent_App_Name, record_id_to_add_ref_to, record_ids_to_add_as_ref, reference_field_name):\n    \n    fs2=open('c:/test/jlaufer.txt','w')\n    fs2.write('alarm_id:' + alarm_id + '\\n**************\\nParent_App_Name:' + Parent_App_Name + '\\nrecord_id_to_add_ref_to:' +  record_id_to_add_ref_to + '\\nrecord_ids_to_add_as_ref' + record_ids_to_add_as_ref + '\\nreference_field_name:' + reference_field_name + '\\n')\n    fs2.close()\n    \n    parent_app = App.find(name=Parent_App_Name)\n    parent_app_id = parent_app.id\n    parent_record = Record.find(parent_app_id, record_id_to_add_ref_to)\n    ref_field_id = parent_app.field_id(reference_field_name)\n    try:\n        if type(record_ids_to_add_as_ref) is list:\n            parent_record.values[ref_field_id].extend(record_ids_to_add_as_ref)\n        else:\n            parent_record.values[ref_field_id].extend([record_ids_to_add_as_ref])\n    except Exception:\n        parent_record.values[ref_field_id] = record_ids_to_add_as_ref\n    parent_record.update()\n\n\ndef create_record(parent_App_ID, child_App_ID, parent_record_id, **kwargs):\n    function_name = 'create_record'\n    child_app = App.find(app_id=child_App_ID)\n    # child_App_ID = child_app.id\n    child_record = Record.new_for(child_App_ID)\n    default_na_value = \"Not Available\"\n    # Grab all the text fields from the Child app (aka, Base Events) and see if a value was supplied for that text field\n    # if not set it as a default value of \"N/A\"\n    for field in child_app.fields:\n        if field['fieldType'] == \"text\":\n            child_record.values[field['id']] = kwargs[field['name']] if field['name'] in kwargs else default_na_value\n    sw_Cust_name = child_app.field_id(\"Customer_Name\")\n    child_record.values[sw_Cust_name] = customer_name\n    ################\n    # Restrict Base Event record\n    #################\n    #rest(child_record.id)\n    # child_record.insert()\n\n    # Add record as reference\n    # child_recordid = child_record.id\n    ##parent_app = App.find(app_id=parent_App_ID)\n    ##parent_app_ID = parent_app.id\n    \"\"\"\n    parent_record = Record.find(parent_app_ID, parent_record_id)\n    ref_field_id = parent_app.field_id(\"Base Events\")\n    try:\n        parent_record.values[ref_field_id].extend([child_recordid])\n    except Exception:\n        parent_record.values[ref_field_id] = [child_recordid]\n    parent_record.save()\n    \"\"\"\n\n    # update child record with parent record id\n    \"\"\"\n    sw_child_field_ID = child_app.field_id(\"Alarm_ID\")\n    child_record.values[sw_child_field_ID] = str(parent_record_id)\n    sw_parentID_URL = child_app.field_id(\"Alarm URL\")\n    child_record.values[sw_parentID_URL] = url_to_hyperlink(\n        \"https://{}/record/\".format(host) + str(parent_app_ID) + \"/\" + str(parent_record_id),\n        \"Click here for parent record\")\n    child_record.save()\n    \"\"\"\n    return child_record\n\n\ndef append_sw_outputs(output):\n    # with open(\"c:\\\\Swimlane_Temp\\\\raw.txt\",\"a+\") as f:\n    #    f.write(\"OUTPUT: \"+ output + \" customer:\"+ customer)\n    # sw_outputs.append({\"Output\": output, \"Customer_Name\": customer})\n    sw_outputs.append({\"Output\": output})\n\n\ndef NSM_auth(esm_ip, username, passwd, url):\n    auth_String = base64.encodestring('%s:%s' % (username, passwd)).strip()\n    login_url = url + 'login'\n    login_headers = {'Authorization': 'Basic ' + auth_String, 'accept': 'application/json'}\n    session = requests.session()\n    login_response = session.post(login_url, headers=login_headers, verify=False)\n    return login_response\n\n\n####################\n# Non Mongo DB Code:\n####################\n\ndef qryGetCorrEventDataForID(login_response, eventID, url, customer_name, base_events_app_ID, alarms_app_ID):\n    function_name = 'qryGetCorrEventDataForID'\n    debug = \"Z\"\n    session = login_response.headers['location']\n    session_header = {'Authorization': 'Session ' + session, 'Content-Type': 'application/json',\n                      'accept': 'application/json'}\n    # eventID = \"144955156628\"#sw_context.inputs['EVENT_ID'].strip()\n    eventID = sw_context.inputs['EVENT_ID'].strip()\n    selectFields = {\n        \"eventId\": {\"value\": eventID},\n        \"fields\": [{\"name\": \"Action.Name\"}, {\"name\": \"DstIP\"}, {\"name\": \"DstPort\"}, {\"name\": \"FirstTime\"},\n                   {\"name\": \"EventCount\"}, {\"name\": \"ID\"}, {\"name\": \"LastTime\"}, {\"name\": \"HostID\"},\n                   {\"name\": \"DSIDSigID\"}, {\"name\": \"Rule.msg\"}, {\"name\": \"SrcIP\"}, {\"name\": \"SrcPort\"},\n                   {\"name\": \"ASNGeoDst\"}, {\"name\": \"ASNGeoSrc\"}, {\"name\": \"Category\"}, {\"name\": \"Count\"},\n                   {\"name\": \"Device_Action\"}, {\"name\": \"SessionID\"}, {\"name\": \"Severity\"}, {\"name\": \"CommandID\"},\n                   {\"name\": \"Destination_Directory\"}, {\"name\": \"Destination_Filename\"},\n                   {\"name\": \"Destination_Zone\"}, {\"name\": \"File_Hash\"}, {\"name\": \"Filename\"}, {\"name\": \"Hash\"},\n                   {\"name\": \"Hash_Type\"}, {\"name\": \"Logon_Type\"}, {\"name\": \"Message_Text\"}, {\"name\": \"Method\"},\n                   {\"name\": \"Object_Type\"}, {\"name\": \"ObjectID\"}, {\"name\": \"Priority\"}, {\"name\": \"Process_Name\"},\n                   {\"name\": \"Rule.ID\"}, {\"name\": \"Rule_Name\"}, {\"name\": \"SHA1\"}, {\"name\": \"Signature_Name\"},\n                   {\"name\": \"Source_UserID\"}, {\"name\": \"Source_Zone\"}, {\"name\": \"Threat_Category\"},\n                   {\"name\": \"Threat_Handled\"}, {\"name\": \"Threat_Name\"}, {\"name\": \"URL\"}, {\"name\": \"User_Agent\"},\n                   {\"name\": \"Rule_NDSNormSigID.msg\"}, {\"name\": \"ZoneDst\"}, {\"name\": \"Zone_ZoneDst.Name\"},\n                   {\"name\": \"ZoneSrc\"}, {\"name\": \"Zone_ZoneSrc.Name\"}, {\"name\": \"DomainID\"}, {\"name\": \"Direction\"}]\n    }\n    results = requests.post(url + \"qryGetCorrEventDataForID?queryType=EVENT\", headers=session_header, verify=False,\n                            json=selectFields)\n    if str(results.status_code) in ['200', '201']:\n        \n        #base_events_counter = 0\n        dict_results = ast.literal_eval(results.text)\n        references_to_add = []\n        base_events_to_insert = []\n        # base_events_app = App.find(app_id = base_events_app_ID)\n        alarms_app = App.find(app_id=alarms_app_ID)\n        for item in dict_results['return']:\n            for dict_item in item.values():\n                base_events_counter += 1\n                Action_Name, DstIP, DstPort, Event_Time, EventCount, EventID, LastTime, Log_Source_Name, SIEM_Rule_ID, SIEM_Rule_Name, SrcIP, SrcPort, ASN_GeoIP_Dst, ASN_GeoIP_Src, Category, Count, Device_Action, SessionID, Severity, Command, Destination_Directory, Destination_Filename, Destination_Zone, File_Hash, Filename, Hash, Hash_Type, Logon_Type, Message_Text, Method, Object_Type, ObjectID, Priority, Process_Name, Rule_ID, Rule_Name, SHA1, Signature_Name, Source_UserID, Source_Zone, Threat_Category, Threat_Handled, Threat_Name, URL, User_Agent, SIEM_Normalization_ID, SIEM_ZoneDst_ID, SIEM_ZoneDst_Name, SIEM_ZoneSrc_ID, SIEM_ZoneSrc_Name, Destination_Domain, Direction = dict_item\n                parent_record_id = sw_context.config[\"RecordId\"]\n                Source_Domain = \"N\\A\"\n                URL = URL.replace(\"\\\\\", \"\")\n                base_events_to_insert.append(\n                    create_record(\"Alarms\", base_events_app_ID, parent_record_id, Action_Name=Action_Name, DstIP=DstIP,\n                                  DstPort=DstPort, Event_Time=format_dt(Event_Time.replace(\"\\\\\", \"\")),\n                                  EventCount=EventCount, EventID=EventID,\n                                  LastTime=format_dt(LastTime.replace(\"\\\\\", \"\")), Log_Source_Name=Log_Source_Name,\n                                  SIEM_Rule_ID=SIEM_Rule_ID, SIEM_Rule_Name=SIEM_Rule_Name, SrcIP=SrcIP,\n                                  SrcPort=SrcPort, ASN_GeoIP_Dst=ASN_GeoIP_Dst, ASN_GeoIP_Src=ASN_GeoIP_Src,\n                                  Category=Category, Count=Count, Device_Action=Device_Action, SessionID=SessionID,\n                                  Severity=Severity, Command=Command, Destination_Directory=Destination_Directory,\n                                  Destination_Filename=Destination_Filename, Destination_Zone=Destination_Zone,\n                                  Destination_Domain=Destination_Domain, Direction=Direction, File_Hash=File_Hash,\n                                  Filename=Filename, Hash=Hash, Hash_Type=Hash_Type, Logon_Type=Logon_Type,\n                                  Message_Text=Message_Text, Method=Method, Object_Type=Object_Type,\n                                  ObjectID=ObjectID,\n                                  Priority=Priority, Process_Name=Process_Name, Rule_ID=Rule_ID,\n                                  Rule_Name=Rule_Name,\n                                  SHA1=SHA1, Signature_Name=Signature_Name, Source_UserID=Source_UserID,\n                                  Source_Zone=Source_Zone, Threat_Category=Threat_Category,\n                                  Threat_Handled=Threat_Handled, Threat_Name=Threat_Name, URL=URL,\n                                  User_Agent=User_Agent, SIEM_Normalization_ID=SIEM_Normalization_ID,\n                                  SIEM_ZoneDst_ID=SIEM_ZoneDst_ID, SIEM_ZoneDst_Name=SIEM_ZoneDst_Name,\n                                  SIEM_ZoneSrc_ID=SIEM_ZoneSrc_ID, SIEM_ZoneSrc_Name=SIEM_ZoneSrc_Name))\n                # fs.write(dict_results)\n        # fs.close\n\n        base_event_records_extracted = [ob._fields for ob in base_events_to_insert]\n        Client.post(base_event_records_extracted, \"app/{0}/record/batch\".format(base_events_app_ID))\n        global base_events_counter\n        base_events_counter=len(base_events_to_insert)\n        for base_event in base_events_to_insert:\n            references_to_add.append(base_event.id)\n\n        ref_field_id = alarms_app.field_id(\"Base Events\")\n        # raise Exception(\"alarms_app_ID={}, parent_record_id={}, ref_field_id={}, references_to_add={}\".format(alarms_app_ID, parent_record_id, ref_field_id, references_to_add))\n        Record.add_reference(alarms_app_ID, parent_record_id, ref_field_id, references_to_add)\n        # add_records_as_reference(\"Alarms\", parent_record_id, references_to_add, \"Base Events\")\n        append_sw_outputs(\"API Call & Reference lookup success\")\n        \n\n    else:\n        append_sw_outputs(\"[HTTP Response Code]: \" + str(results.status_code) + \" [NSM Response Text]: \" + str(\n            results.text) + \". Auth success, however the lookup for EventID \" + eventID + \" in NSM failed\")\n\n\ndef qryRSAforBaseEvents(eventID, MongoDBIP, MongoUser, MongoPass, MongoDB, MongoCollection, customer_name,\n                        base_events_app_ID, alarms_app_ID):\n    function_name = 'qryRSAforBaseEvents'\n    # CONNECT TO MONGO\n    if python_dynamic_code == 'On':\n        connstring = \"mongodb://{user}:{MongoPass}@{MongoDBIP}:27017/{db}\".format(user=MongoUser, MongoPass=MongoPass,\n                                                                                  MongoDBIP=MongoDBIP, db=MongoDB)\n        client = MongoClient(connstring)\n        db = client[MongoDB]\n        mycollection = db[MongoCollection]\n\n        try:\n\n            regx = re.compile(r'.*?\":\"PerformIntegration', re.IGNORECASE)\n            entries = mycollection.find({\"_id\": str(eventID)}, {\"events\": \"1\", \"_id\": \"0\"}).limit(1)\n            num_results = 0\n            debug_field_name = ''\n            module1 = ''\n            db1 = connect_to_Mongo()\n            fieldCode = db1.CodeData.find({\"$and\": [{\"Enabled\": \"Y\"}, {\"Platform\": \"RSA\"}]})\n            # fieldCode=db1.CodeData.find({\"$and\":[{\"Platform\":\"RSA\"},{\"Enabled\":\"Y\"},{\"Swimlane_Object\":\"Alarms|Integration|Step 3 Modular Get Base Events and Translate Creds|qryRSAforBaseEvents\"}]})\n            list_of_fields = []\n            for x in fieldCode:\n                module1 = module1 + '\\n' + str(x[\"Python_Code\"])\n                # debug_field_name=debug_field_name + \" \\\" \" + str(x[\"Field_Name\"]) + \":\\\" + str(\" + str(x[\"Field_Name\"]) + \") + \"\n\n                #########################\n                # Creation of Test Cases\n                #########################\n                '''\n                line=\"if \" + x[\"Field_Name\"] + \"==\" + x[\"Field_Name\"] + \"_src:\\n\"\n                line=line + \"    fs.write(\" + \"\\\"\" + x[\"Field_Name\"] + \":Passed\\\"\" + \")\\n\"\n                line=line + \"else:\\n\"\n                line=line + \"    \" + \"fs.write(\" + \"\\\"\" + x[\"Field_Name\"] + \":Failed\\\"\" + \")\\n\\n\"\n                list_of_fields.append(line)\n\n\n            fs.write(module1 + '\\n\\n')\n            fs.write('DebugField:' + '\\n')\n            debug_field_name=debug_field_name[1:-3]\n            fs.write(debug_field_name + '\\n\\n')\n            # fs.write(\"DstIP:\" + DstIP + \" ,DstPort:\" + DstPort + \", EventID:\" + EventID\n            '''\n\n            references_to_add = []\n            for obj in entries:\n                num_results += 1\n                for entry in obj['events']:\n                    exec module1\n\n                    references_to_add.append(\n                        create_record(\"Alarms\", \"Base Events\", parent_record_id, Action_Name=Action_Name, DstIP=DstIP,\n                                      DstPort=DstPort, Event_Time=Event_Time, EventID=EventID,\n                                      Log_Source_Name=Log_Source_Name,\n                                      SIEM_Rule_ID=SIEM_Rule_ID, SIEM_Rule_Name=SIEM_Rule_Name, SrcIP=SrcIP,\n                                      SrcPort=SrcPort,\n                                      ASN_GeoIP_Dst=ASN_GeoIP_Dst, ASN_GeoIP_Src=ASN_GeoIP_Src, Category=Category,\n                                      Device_Action=Device_Action, Severity=Severity, Command=Command,\n                                      Destination_Directory=Destination_Directory, Destination_Zone=Destination_Zone,\n                                      Source_Domain=Source_Domain, Destination_Domain=Destination_Domain,\n                                      Direction=Direction,\n                                      Filename=Filename, Hash=Hash, Logon_Type=Logon_Type, Message_Text=Message_Text,\n                                      Method=Method, Object_Type=Object_Type, ObjectID=ObjectID,\n                                      Process_Name=Process_Name,\n                                      Rule_ID=Rule_ID, Rule_Name=Rule_Name, Signature_Name=Signature_Name,\n                                      Source_UserID=Source_UserID, Source_Zone=Source_Zone,\n                                      Threat_Handled=Threat_Handled,\n                                      Threat_Name=Threat_Name, URL=URL, User_Agent=User_Agent,\n                                      SIEM_Normalization=SIEM_Normalization))\n\n            add_records_as_reference(\"Alarms\", parent_record_id, references_to_add, \"Base Events\")\n\n            \n            '''\n            ##############################\n            # Validation of fields\n            ##############################\n\n            fs.write('\\n\\n\\nValidation of Original Values versus Mongo Stored Variables:\\n')\n            #fs.write(list_of_fields[0])\n            ####################\n            #Test Failure Case:\n            ####################\n            #DstIP_src='nnn'\n            fs.write(\"\\nSingle Test for DstIP:\\n\")\n            fs.write(\"\\tOriginal DstIP:\\t\\t \" + DstIP_src + \"\\n\")\n            fs.write(\"\\tPythonModule DstIP:\\t\\t \" + DstIP + \"\\n\")\n            if DstIP==DstIP_src:\n              fs.write(\"DstIP:Passed\\n\\n\")\n            else:\n              fs.write(\"DstIP:Failed\\n\\n\")\n\n            ####################\n\n            ##################################\n            #Create list of Test Case Results:\n            ##################################\n            for x in list_of_fields:\n              #x_src=x + \"_src\"\n              #fs.write(x + '\\n')\n              exec (x)\n              fs.write('\\n')\n\n\n            '''\n            if num_results > 0:\n                append_sw_outputs(\n                    \"RSA lookup of EventID: {eventid} returned 0 results in Mongo.\".format(eventid=str(eventID)))\n                # fs.close\n            global base_events_counter\n            base_events_counter = num_results\n        except Exception as e:\n            ln_nbr = '832'\n            TOTAL_TIME = (datetime.datetime.now() - s)\n            # TOTAL_TIME=\"{}\".format(datetime.datetime.now(), (datetime.datetime.now() - s))\n            # Create_Error_Log_Entry(ln_nbr,function_name,'Y',str(e),str(TOTAL_TIME))\n            Create_Error_Log_Entry(prg_name, ln_nbr, function_name, 'Y', str(error_msg), str(TOTAL_TIME).split('.')[0],\n                                   alarm_id, full_message, action_name, fs, customer_name, '', '', '')\n\n            debug_text = \" ERROR Message: \" + str(e)\n            # START_TIME = datetime.datetime.now()\n            # fs.write(\"\\r\\n[{}] START\".format(START_TIME) + ' Alarm File:' + '\\t' + sw_context.inputs['action_name'])\n            # fs.write(\"\\r\\n[{}] Error\".format(START_TIME) + ' ' + sw_context.inputs['action_name'] + ' Line 738 ' + debug_text + str(customer_name) + '\\n')\n            # Create_Error_Log_Entry(str(e),\"758\")\n            append_sw_outputs(debug_text)\n            # fs.close\n\n    # Non Mongo Python Code\n    #########################\n    if python_dynamic_code != 'On':\n        connstring = \"mongodb://{user}:{MongoPass}@{MongoDBIP}:27017/{db}\".format(user=MongoUser, MongoPass=MongoPass,\n                                                                                  MongoDBIP=MongoDBIP, db=MongoDB)\n        client = MongoClient(connstring)\n        db = client[MongoDB]\n        mycollection = db[MongoCollection]\n\n        try:\n            regx = re.compile(r'.*?\":\"PerformIntegration', re.IGNORECASE)\n            entries = mycollection.find({\"_id\": str(eventID)}, {\"events\": \"1\", \"_id\": \"0\"}).limit(1)\n            num_results = 0\n            references_to_add = []\n            base_events_to_insert = []\n            alarms_app = App.find(app_id=alarms_app_ID)\n            for obj in entries:\n                num_results += 1\n                for entry in obj['events']:\n\n                    DstIP = entry.get('ip_dst')\n                    DstPort = str(entry.get('ip_dstport'))\n                    EventID = str(entry.get('sessionid'))\n                    SIEM_Rule_ID = entry.get('alert_id')\n                    SIEM_Rule_Name = entry.get('event_cat_name')\n                    SrcPort = str(entry.get('ip_srcport'))\n                    ASN_GeoIP_Dst = entry.get('country_dst')\n                    ASN_GeoIP_Src = entry.get('country_src')\n                    Category = entry.get('category')\n                    Severity = str(entry.get('severity'))\n                    Destination_Directory = entry.get('directory')\n                    Direction = entry.get('direction')\n                    Filename = entry.get('filename')\n                    Logon_Type = entry.get('logon_type')\n                    Method = entry.get('web_method')\n                    Object_Type = entry.get('obj_type')\n                    Process_Name = entry.get('process')\n                    Rule_ID = entry.get('rule')\n                    Rule_Name = entry.get('rule_name')\n                    Signature_Name = entry.get('sig_id_str')\n                    Threat_Category = str(entry.get('threat_category'))\n                    URL = entry.get('url')\n                    User_Agent = entry.get('user_agent')\n                    Threat_Handled = entry.get('disposition')\n                    Hash = entry.get('checksum')\n                    SIEM_Normalization = entry.get('event_cat_name')\n\n                    # Action_Name\n                    if entry.get('action') != None:\n                        Action_Name = entry.get('action')\n                    elif entry.get('ec_activity') != None:\n                        Action_Name = entry.get('ec_activity')\n                    elif entry.get('ec_outcome') != None:\n                        Action_Name = entry.get('ec_outcome')\n                    elif entry.get('disposition') != None:\n                        Action_Name = entry.get('disposition')\n                    else:\n                        Action_Name = \"Not Available\"\n                    Action_Name=\",\".join(Action_Name)    \n\n                    # Event_Time\n                    if entry.get('event_time') != None:\n                        try:\n                            #Event_Time = datetime.datetime.fromtimestamp(entry.get('event_time')).strftime('%c')\n                            Event_Time = datetime.datetime.fromtimestamp(entry.get('event_time')).strftime('%m/%d/%Y %H:%M:%S')\n                        except:\n                            #Event_Time = datetime.datetime.fromtimestamp(entry.get('event_time') / 1000).strftime('%c')\n                            Event_Time = datetime.datetime.fromtimestamp(entry.get('event_time') / 1000).strftime('%m/%d/%Y %H:%M:%S')\n                    elif entry.get('esa_time') != None:\n                        try:\n                            #Event_Time = datetime.datetime.fromtimestamp(entry.get('esa_time')).strftime('%c')\n                            Event_Time = datetime.datetime.fromtimestamp(entry.get('esa_time')).strftime('%m/%d/%Y %H:%M:%S')\n                        except:\n                            #Event_Time = datetime.datetime.fromtimestamp(entry.get('esa_time') / 1000).strftime('%c')\n                            Event_Time = datetime.datetime.fromtimestamp(entry.get('esa_time') / 1000).strftime('%m/%d/%Y %H:%M:%S')\n                    else:\n                        Event_Time = \"Not Available\"\n\n                    # Log_Source_Name\n                    if entry.get('event_computer') != None:\n                        Log_Source_Name = entry.get('event_computer')\n                    elif entry.get('device_host') != None:\n                        Log_Source_Name = entry.get('device_host')\n                    elif entry.get('event_source_id') != None:\n                        Log_Source_Name = entry.get('event_source_id')\n                    else:\n                        Log_Source_Name = \"Not Available\"\n\n                    # SrcIP\n                    if entry.get('ip_src') != None:\n                        SrcIP = entry.get('ip_src')\n                    elif entry.get('host_src') != None:\n                        SrcIP = entry.get('host_src')\n                    elif entry.get('device_ip') != None:\n                        SrcIP = entry.get('device_ip')\n                    else:\n                        SrcIP = \"Not Available\"\n                    SrcIP=str(SrcIP)    \n\n                    # Device_Action\n                    if entry.get('action') != None:\n                        Device_Action = entry.get('action')\n                    elif entry.get('ec_activity') != None:\n                        Device_Action = entry.get('ec_activity')\n                    elif entry.get('ec_outcome') != None:\n                        Device_Action = entry.get('ec_outcome')\n                    elif entry.get('disposition') != None:\n                        Device_Action = entry.get('disposition')\n                    else:\n                        Device_Action = \"Not Available\"\n                    Device_Action=\",\".join(Device_Action)    \n\n                    # Command\n                    if entry.get('web_method') != None:\n                        Command = str(entry.get('web_method'))\n                    elif entry.get('process') != None:\n                        Command = str(entry.get('process'))\n                    else:\n                        Command = \"Not Available\"\n\n                    # Destination_Zone\n                    if entry.get('zone') != None:\n                        Destination_Zone = str(entry.get('zone'))\n                    elif entry.get('Zone_dst') != None:\n                        Destination_Zone = str(entry.get('Zone_dst'))\n                    elif entry.get('zone_dst') != 'None':\n                        Destination_Zone = str(entry.get('zone_dst'))\n                    else:\n                        Destination_Zone = \"Not Available\"\n\n                    # Source_Domain\n                    if entry.get('domain_src') != None:\n                        Source_Domain = str(entry.get('domain_src'))\n                    elif entry.get('ad_domain_src') != None:\n                        Source_Domain = str(entry.get('ad_domain_src'))\n                    else:\n                        Source_Domain = \"Not Available\"\n\n                    # Destination_Domain\n                    if entry.get('domain_dst') != None:\n                        Destination_Domain = entry.get('domain_dst')\n                    elif entry.get('ad_domain_dst') != None:\n                        Destination_Domain = entry.get('ad_domain_dst')\n                    elif entry.get('domain') != None:\n                        Destination_Domain = entry.get('domain')\n                    elif entry.get('web_domain') != None:\n                        Destination_Domain = entry.get('web_domain')\n                    else:\n                        Destination_Domain = \"Not Available\"\n\n                    # Message_Text\n                    if entry.get('msg') != None:\n                        Message_Text = entry.get('msg')\n                    elif entry.get('msg_id') != None:\n                        Message_Text = entry.get('msg_id')\n                    else:\n                        Message_Text = \"Not Available\"\n\n                    # ObjectID\n                    if entry.get('obj_name') != None:\n                        ObjectID = entry.get('obj_name')\n                    elif entry.get('obj_id'):\n                        ObjectID = entry.get('obj_id')\n                    else:\n                        ObjectID = \"Not Available\"\n\n                    # Source_UserID\n                    if entry.get('ad_username_src') != None:\n                        Source_UserID = entry.get('ad_username_src')\n                    elif entry.get('event_user') != None:\n                        Source_UserID = entry.get('event_user')\n                    elif entry.get('user_src') != None:\n                        Source_UserID = entry.get('user_src')\n                    elif entry.get('username') != None:\n                        Source_UserID = entry.get('username')\n                    else:\n                        Source_UserID = \"Not Available\"\n\n                    # Source_Zone\n                    if entry.get('Zone_src') != None:\n                        Source_Zone = entry.get('Zone_src')\n                    elif entry.get('zone_src') != None:\n                        Source_Zone = entry.get('zone_src')\n                    else:\n                        Source_Zone = \"Not Available\"\n\n                    # Threat_Name\n                    if entry.get('virusname') != None:\n                        Threat_Name = entry.get('virusname')\n                    elif entry.get('obj_name') != None:\n                        Threat_Name = entry.get('obj_name')\n                    else:\n                        Threat_Name = \"Not Available\"\n\n                    parent_record_id = sw_context.config[\"RecordId\"]\n\n                    # fs.write(\"Alarms\", \"Base Events\", \"parent_record_id\", \"Action_Name\",\"DstIP\",\"DstPort\",\"Event_Time\",\"EventID\",\"Log_Source_Name\",\"SIEM_Rule_ID\",\"SIEM_Rule_Name\",\"SrcIP\",\"SrcPort\",\"ASN_GeoIP_Dst\",\"ASN_GeoIP_Src\",\"Category\",\"Device_Action\",\"Severity\",\"Command\",\"Destination_Directory\",\"Destination_Zone\",\"Source_Domain\",\"Destination_Domain\",\"Direction\",\"Filename\",\"Hash\",\"Logon_Type\",\"Message_Text\",\"Method\",,\"Object_Type\",\"ObjectID\",\"Process_Name\",\"Rule_ID\",\"Rule_Name\",\"Signature_Name\",\"Source_UserID\",\"Source_Zone\",\"Threat_Handled\",\"Threat_Name\",\"URL\",\"User_Agent\")\n                    # fs.write(\"Alarms\", \"Base Events\", parent_record_id, Action_Name,DstIP,DstPort,Event_Time,EventID,Log_Source_Name,SIEM_Rule_ID,SIEM_Rule_Name,SrcIP,SrcPort,ASN_GeoIP_Dst,ASN_GeoIP_Src,Category,Device_Action,Severity,Command,Destination_Directory,Destination_Zone,Source_Domain,Destination_Domain,Direction,Filename,Hash,Logon_Type,Message_Text,Method,,Object_Type,ObjectID,Process_Name,Rule_ID,Rule_Name,Signature_Name,Source_UserID,Source_Zone,Threat_Handled,Threat_Name,URL,User_Agent)\n\n                    base_events_to_insert.append(\n                        create_record(\"Alarms\", base_events_app_ID, parent_record_id, Action_Name=Action_Name,\n                                      DstIP=DstIP,\n                                      DstPort=DstPort, Event_Time=Event_Time, EventID=EventID,\n                                      Log_Source_Name=Log_Source_Name,\n                                      SIEM_Rule_ID=SIEM_Rule_ID, SIEM_Rule_Name=SIEM_Rule_Name, SrcIP=SrcIP,\n                                      SrcPort=SrcPort,\n                                      ASN_GeoIP_Dst=ASN_GeoIP_Dst, ASN_GeoIP_Src=ASN_GeoIP_Src, Category=Category,\n                                      Device_Action=Device_Action, Severity=Severity, Command=Command,\n                                      Destination_Directory=Destination_Directory, Destination_Zone=Destination_Zone,\n                                      Source_Domain=Source_Domain, Destination_Domain=Destination_Domain,\n                                      Direction=Direction,\n                                      Filename=Filename, Hash=Hash, Logon_Type=Logon_Type, Message_Text=Message_Text,\n                                      Method=Method, Object_Type=Object_Type, ObjectID=ObjectID,\n                                      Process_Name=Process_Name,\n                                      Rule_ID=Rule_ID, Rule_Name=Rule_Name, Signature_Name=Signature_Name,\n                                      Source_UserID=Source_UserID, Source_Zone=Source_Zone,\n                                      Threat_Handled=Threat_Handled,\n                                      Threat_Name=Threat_Name, URL=URL, User_Agent=User_Agent,\n                                      SIEM_Normalization=SIEM_Normalization))\n            if base_events_to_insert:\n                base_event_records_extracted = [ob._fields for ob in base_events_to_insert]\n                Client.post(base_event_records_extracted, \"app/{0}/record/batch\".format(base_events_app_ID))\n\n                for base_event in base_events_to_insert:\n                    references_to_add.append(base_event.id)\n\n                ref_field_id = alarms_app.field_id(\"Base Events\")\n                # raise Exception(\"alarms_app_ID={}, parent_record_id={}, ref_field_id={}, references_to_add={}\".format(alarms_app_ID, parent_record_id, ref_field_id, references_to_add))\n                '''\n                fs3=open('c:/test/BaseEventRecordRefer.txt','w')\n                fs3.write(\"alarms_app_ID={}, parent_record_id={}, ref_field_id={}, references_to_add={}\".format(alarms_app_ID, parent_record_id, ref_field_id, references_to_add))\n                fs3.close()\n                '''\n                Record.add_reference(alarms_app_ID, parent_record_id, ref_field_id, references_to_add)\n\n            append_sw_outputs(\"API Call & Reference lookup success\")\n\n            if len(base_events_to_insert) > 0:\n                append_sw_outputs(\"RSA lookup of EventID: {eventid} results in Mongo for \".format(eventid=str(eventID)))\n                  \n                  #\"RSA lookup of EventID: {eventid} returned {count} results in Mongo.\".format(eventid=str(eventID),str(len(base_events_to_insert))),str(customer_name))\n                # fs.close\n\n            global base_events_counter\n            base_events_counter=len(base_events_to_insert)\n        except Exception as e:\n            ln_nbr='1063'\n            #TOTAL_TIME=\"{}\".format(datetime.datetime.now(), (datetime.datetime.now() - s))\n            TOTAL_TIME=(datetime.datetime.now()-s)\n            fs.write('Error line 1063:' + str(e) + '\\n')\n            #Create_Error_Log_Entry(prg_name,ln_nbr,function_name,'Y',str(e),str(TOTAL_TIME).split('.')[0],alarm_id,full_message,action_name,fs,customer_name,'','','')\n            debug_text = \" ERROR Message: \" + str(e)\n            START_TIME = datetime.datetime.now()\n            #fs.write(\"\\r\\n[{}] START\".format(START_TIME) + ' Alarm File:' + '\\t' + sw_context.inputs['action_name'])\n            fs.write(\"\\r\\n[{}] Error\".format(START_TIME) + ' ' + sw_context.inputs['action_name'] + ' Line 953 ' + debug_text + '\\n')\n            fs.write(debug_text + '\\n')\n            #Create_Error_Log_Entry(str(e),\"977\")\n            #fs.write('Line 953 ' + debug_text + '\\n')\n            append_sw_outputs(debug_text)\n            # fs.close\n\n\n# fs.close\n# Create_Error_Log_Entry('Test ' ,'987')\n\n\nerror_msg = \"\"\n\n# Translate CustomerID to Customer Name. Grab proper creds & SIEM IP\n#\ncustomer_id = sw_context.inputs[\"Customer_ID\"]\n# customer_id = \"TSOC1-Legend Correlation Engine\" #for testing\n\ncustomer_name = \"\"\nsiem_ip = \"\"\nsiem_user = \"\"\ncredential_set = \"\"\nfor item in customer:\n    if item[\"customer_id\"] == customer_id:\n        customer_name = item[\"customer_name\"]\n        siem_ip = item[\"siem_ip\"]\n        global siem_user\n        siem_user = item[\"siem_user\"]\n        global credential_set_name\n        credential_set_name = item[\"credential_set\"]\n        # print(str(customer_name) + str(siem_ip))\n        break\nif customer_name == \"\":\n    error_msg = \"Customer ID not found in translation file\"\n# sw_outputs.append({\"Customer_Name\": customer})\n#######################################################\n# Use SIEM_Platform to determine which API call to make#\n#######################################################\n\nSIEM_Platform = sw_context.inputs[\"SIEM_Platform\"]\n# SIEM_Platform = \"RSA\" #for testing\n\n######################\n# McAfee(ESM) API Call#\n######################\n\nif error_msg == \"\" and SIEM_Platform == \"McAfee\":\n    if timeprofile_switch != 'Off':\n        # s = datetime.datetime.now()\n        f.write(\"\\r\\n[{}] start McAfee lookup\".format(s))\n    url = 'https://' + siem_ip + '/rs/esm/'\n    login_response = NSM_auth(siem_ip, sw_context.inputs[siem_user], sw_context.inputs[credential_set_name], url)\n    #login_response = NSM_auth(siem_ip, siem_user, credential_set_name, url)\n    # login_response = NSM_auth(siem_ip,\"tsoc1_api\",\"F0y6uJfi4JteAvspgtoo\", url)\n\n    if str(login_response.status_code) in ['200', '201']:\n        # qryGetCorrEventDataForID(login_response, \"144955156628\", url, customer_name)\n        qryGetCorrEventDataForID(login_response, sw_context.inputs['EVENT_ID'].strip(), url, customer_name,\n                                 Base_events_app_ID, Alarms_app_ID)\n        # print str(login_response.status_code)\n    else:\n        output_text = \"HTTP Response: \" + str(login_response.status_code) + \"Response Text: \" + str(\n            siem_user)  # str(login_response.text)\n        append_sw_outputs(\"[C] \" + str(output_text))\n    # TOTAL_TIME=\"{}\".format(datetime.datetime.now(), (datetime.datetime.now() - s))\n    TOTAL_TIME = (datetime.datetime.now() - s)\n    function_name = 'McAfee Main'\n    Create_Error_Log_Entry(prg_name, '1141', function_name, 'N', '', str(TOTAL_TIME).split('.')[0], alarm_id, full_message, action_name, fs, customer_name, '', sw_context.inputs['siem_rule_name'], str(base_events_counter))\n\n    # print output_text\n    # f.write('End\\n')\n    # f.write('\\nEnd McFee lookup. Total={}'.format(datetime.datetime.now(), (datetime.datetime.now() - s)))\n    if timeprofile_switch != 'Off':\n        f.write(\"\\r\\n[{}] end McAfee lookup. total={}\".format(datetime.datetime.now(), (datetime.datetime.now() - s)))\n\n##############\n# RSA API Call#\n##############\n# elif error_msg == \"\" and SIEM_Platform == \"RSA\":\nelif error_msg == \"\" and SIEM_Platform == \"RSA\":\n    if timeprofile_switch == 'On':\n        s = datetime.datetime.now()\n        f.write(\"\\r\\n[{}] start RSA lookup dynamic python code is{}\".format(s, python_dynamic_code))\n\n    MongoDBIP = siem_ip\n    MongoUser = sw_context.inputs[siem_user]  # \"esa\"\n    MongoPass = sw_context.inputs[credential_set_name]  # \"esa\"\n    MongoDB = \"esa\"\n    MongoCollection = \"alert\"\n    qryRSAforBaseEvents(sw_context.inputs['EVENT_ID'].strip(), MongoDBIP, MongoUser, MongoPass, MongoDB,\n                        MongoCollection, customer_name, Base_events_app_ID, Alarms_app_ID)\n    if timeprofile_switch == 'On':\n        f.write(\"\\r\\n[{}] end RSA lookup. total={}\".format(datetime.datetime.now(), (datetime.datetime.now() - s)))\n    # TOTAL_TIME=\"{}\".format(datetime.datetime.now(), (datetime.datetime.now() - s))\n    function_name = 'RSA Main'\n    TOTAL_TIME = (datetime.datetime.now() - s)\n    Create_Error_Log_Entry(prg_name, '1152', function_name, 'N', '', str(TOTAL_TIME).split('.')[0], alarm_id,full_message, action_name, fs, customer_name, '', sw_context.inputs['siem_rule_name'], str(base_events_counter))\n\n    # Create_Error_Log_Entry('1152',function_name,'N','',str(TOTAL_TIME))\n\nelse:\n    pass\n\nif timeprofile_switch == 'On':\n    # f.write(\"\\r\\n[{}]\" + sw_context.inputs['action_name'] + \" END.         TOTAL TIME=[{}]\".format(datetime.datetime.now(), (datetime.datetime.now() - START_TIME1)))\n    f.write(\"\\r\\n[{}] {}                 END.                  TOTAL_TIME=[{}]\".format(datetime.datetime.now(),\n                                                                                       sw_context.inputs['action_name'],\n                                                                                       (datetime.datetime.now() - s)))\n    f.close()\n\n# Print error message if any\nif error_msg != \"\":\n    ln_nbr = '1164'\n    function_name = 'Main'\n    TOTAL_TIME = (datetime.datetime.now() - s)\n    # TOTAL_TIME=\"{}\".format(datetime.datetime.now(), (datetime.datetime.now() - s))\n    Create_Error_Log_Entry(prg_name, ln_nbr, function_name, 'Y', str(error_msg), str(TOTAL_TIME).split('.')[0], alarm_id, full_message, action_name, fs, customer_name, '', sw_context.inputs['siem_rule_name'], str(base_events_counter))\n    # Create_Error_Log_Entry(prg_name, ln_nbr, function_name, 'Y', str(error_msg), str(TOTAL_TIME).split('.')[0], alarm_id, full_message, action_name, fs, customer_name)\n    # START_TIME = datetime.datetime.now()\n    # fs.write(\"\\r\\n[{}] START\".format(START_TIME) + ' Alarm File:' + '\\t' + sw_context.inputs['action_name'])\n    # fs.write(\"\\r\\n[{}] Error\".format(START_TIME) + ' ' + sw_context.inputs['action_name'] + ' line 1051 ' + error_msg +  ' ' + str(customer_name) + '\\n')\n\n    # fs.write('line 1051 ' + error_msg +  ' ' + str(customer_name) + '\\n')\n    # Create_Error_Log_Entry(str(error_msg),\"1082\")\n    # sw_outputs.append({\"virustotal_processing\":error_msg + ' ' +  str(customer_name))\n    append_sw_outputs(error_msg)\nfs.close()\n\n"
    }, 
    "inputMapping": [
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "record", 
            "value": "ah690", 
            "key": "Customer_ID", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "record", 
            "value": "awnez", 
            "key": "SIEM_Platform", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "record", 
            "value": "a8t51", 
            "key": "EVENT_ID", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "tsoc2_user", 
            "key": "TSOC2_User", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "tsoc2_credential", 
            "key": "TSOC2_Credential", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "tsoc1_user", 
            "key": "TSOC1_User", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "tsoc1_credential", 
            "key": "TSOC1_Credential", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "boxster_user", 
            "key": "Boxster_User", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "boxster_credential", 
            "key": "Boxster_Credential", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "m5_user", 
            "key": "M5_User", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "m5_credential", 
            "key": "M5_Credential", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "nosc_user", 
            "key": "NOSC_User", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "nosc_credential", 
            "key": "NOSC_Credential", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "record", 
            "value": "ajzk9", 
            "key": "siem_rule_name", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "record", 
            "value": "a4afj", 
            "key": "action_name", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "record", 
            "value": "azeb0", 
            "key": "full_message", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "record", 
            "value": "583f29e49aee7c0c2044c5bd", 
            "key": "alarm_id", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "record", 
            "value": "aygw6", 
            "key": "customer_name", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "record", 
            "value": "ay859", 
            "key": "base_event_gen", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "apiuser_user", 
            "key": "apiuser_user", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "credentials", 
            "value": "apiuser_credential", 
            "key": "apiuser_credential", 
            "addMissing": false
        }, 
        {
            "$type": "Core.Models.Integrations.Descriptors.Mapping, Core", 
            "type": "literal", 
            "value": "Off", 
            "key": "charm_flag", 
            "addMissing": false
        }
    ], 
    "applicationId": "aYvGaX9lTbPM4", 
    "id": "aYuF3Gd51jLgn"
}